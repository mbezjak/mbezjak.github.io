<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Configuration | Well Organized Bits</title>
<meta name=keywords content><meta name=description content="Which library do you use for project configuration? There are so many to choose from. Take a look at The Clojure Toolbox under &ldquo;Configuration&rdquo;. Choosing the right one mostly comes down to that you want out of the configuration library.
Here are my requirements:
It should not maintain it&rsquo;s own state. So environ is out. It should allow the project to control configuration sources (e.g. from environmental variables, java properties, command line arguments, file (edn?"><meta name=author content="Miro Bezjak"><link rel=canonical href=https://mbezjak.github.io/posts/configuration/><meta name=google-site-verification content="62Vyu3hWVePJQe8DUK8iM3Xn2VdjXAAagXEIxsL5To0"><link crossorigin=anonymous href=/assets/css/stylesheet.b609c58d5c11bb90b1a54e04005d74ad1ddf22165eb79f5533967e57df9c3b50.css integrity="sha256-tgnFjVwRu5CxpU4EAF10rR3fIhZet59VM5Z+V9+cO1A=" rel="preload stylesheet" as=style><link rel=icon href=https://mbezjak.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://mbezjak.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://mbezjak.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://mbezjak.github.io/apple-touch-icon.png><link rel=mask-icon href=https://mbezjak.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><link rel=alternate hreflang=en href=https://mbezjak.github.io/posts/configuration/><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--code-block-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Configuration"><meta property="og:description" content="Which library do you use for project configuration? There are so many to choose from. Take a look at The Clojure Toolbox under &ldquo;Configuration&rdquo;. Choosing the right one mostly comes down to that you want out of the configuration library.
Here are my requirements:
It should not maintain it&rsquo;s own state. So environ is out. It should allow the project to control configuration sources (e.g. from environmental variables, java properties, command line arguments, file (edn?"><meta property="og:type" content="article"><meta property="og:url" content="https://mbezjak.github.io/posts/configuration/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-11-23T18:30:41+01:00"><meta property="article:modified_time" content="2022-11-23T18:30:41+01:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Configuration"><meta name=twitter:description content="Which library do you use for project configuration? There are so many to choose from. Take a look at The Clojure Toolbox under &ldquo;Configuration&rdquo;. Choosing the right one mostly comes down to that you want out of the configuration library.
Here are my requirements:
It should not maintain it&rsquo;s own state. So environ is out. It should allow the project to control configuration sources (e.g. from environmental variables, java properties, command line arguments, file (edn?"><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Posts","item":"https://mbezjak.github.io/posts/"},{"@type":"ListItem","position":2,"name":"Configuration","item":"https://mbezjak.github.io/posts/configuration/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Configuration","name":"Configuration","description":"Which library do you use for project configuration? There are so many to choose from. Take a look at The Clojure Toolbox under \u0026ldquo;Configuration\u0026rdquo;. Choosing the right one mostly comes down to that you want out of the configuration library.\nHere are my requirements:\nIt should not maintain it\u0026rsquo;s own state. So environ is out. It should allow the project to control configuration sources (e.g. from environmental variables, java properties, command line arguments, file (edn?","keywords":[],"articleBody":"Which library do you use for project configuration? There are so many to choose from. Take a look at The Clojure Toolbox under “Configuration”. Choosing the right one mostly comes down to that you want out of the configuration library.\nHere are my requirements:\nIt should not maintain it’s own state. So environ is out. It should allow the project to control configuration sources (e.g. from environmental variables, java properties, command line arguments, file (edn?) on the classpath, external file, etc.) and their order. cprop seems simple enough, but there is one other requirement. It should help document the configuration that the project uses. After all, someone needs to know how to configure the service properly. Is it DATABASE_URL? DB_URL? DB? What else is there to configure? aero seems to be on the right track. However, if those are the only requirements then implementing your own configuration “library” becomes really simple in Clojure.\nHere is what worked quite well for me.\nconfig_init.clj\n(ns config-init (:refer-clojure :exclude [load]) (:require [clojure.edn :as edn] [clojure.java.io :as io] [my.company.map :as map] [my.company.text :as text])) ;; Default values are production quality safe! It's up to development-like ;; environments to relax the constrains a bit. (def ^:private known-configs [;; required {:key :db-url :env \"DB_URL\"} {:key :db-password :env \"DB_PASSWORD\"} {:key :keycloak-issuer-url :env \"KEYCLOAK_ISSUER_URL\"} {:key :keycloak-client-id :env \"KEYCLOAK_CLIENT_ID\"} ;; optional {:key :elasticsearch-url :env \"ELASTICSEARCH_URL\"} {:key :kms-key-id :env \"KMS_KEY_ID\"} ;; usually different in development-like environments {:key :enable-debug-logging :default false :env \"ENABLE_DEBUG_LOGGING\" :env-transform text/try-as-boolean} ;; rarely needs to be redefined {:key :api-port :default 8800 :env \"API_PORT\" :env-transform text/try-as-int} {:key :flyway-version :default \"latest\" :env \"FLYWAY_VERSION\"} ;; for deployed service: added via Dockerfile {:key :git-tag :env \"GIT_TAG\" :env-transform not-empty} {:key :git-commit-sha :env \"GIT_COMMIT_SHA\"} {:key :build-time :env \"BUILD_TIME\"} ;; local development {:key :developer-focused-logs :default false :env \"DEVELOPER_FOCUSED_LOGS\" :env-transform text/try-as-boolean}]) (defn- from-defaults [] (-\u003e\u003e known-configs (filter #(contains? % :default)) (map (juxt :key :default)) (into {}))) (defn- from-local-edn [] (let [f (io/file \"local/resources/config.edn\")] (when (.exists f) (edn/read-string (slurp f))))) (defn- from-env [] (let [m (-\u003e\u003e known-configs (filter :env) (map (fn [{:keys [key env env-transform]}] (let [transform (or env-transform identity)] [key (transform (System/getenv env))]))) (into {}))] (map/remove-val m nil?))) (defn load [] (merge (from-defaults) (from-local-edn) (from-env))) That is all there is to it. Refer to clojure.core extensions for some of the functions used here.\nConfiguration for local development can be something like the following.\nlocal/resources/config.edn\n{:db-password \"postgres\" :db-url \"jdbc:postgresql://localhost:5432/db?user=postgres\" :keycloak-issuer-url \"https://auth.development.company.com/realms/customer\" :keycloak-client-id \"mobile-app\" :enable-debug-logging true :developer-focused-logs true :git-commit-sha \"local-development\" :build-time \"1970-01-01T00:00:00+00:00\"} Extensions The nice thing when you have your own implementation is that adding stuff that matters to your project becomes really simple.\nFor example, if you have a /health endpoint that returns service configuration then you probably don’t want it returning sensitive values. That seems simple to solve. Just annotate the configuration as needed and redact the values before returning them.\n(def ^:private known-configs ,,, {:key :db-password :sensitive? true :env \"DB_PASSWORD\"} ,,,) (defn redact-sensitive-values [config] (reduce #(assoc %1 %2 \"\") config (-\u003e\u003e known-configs (filter :sensitive?) (map :key)))) Other ideas:\nadd :documentation to those variables where the usage is not clear enough add :used-by #{:admin :mobile} to signal which services are using this variable ","wordCount":"518","inLanguage":"en","datePublished":"2022-11-23T18:30:41+01:00","dateModified":"2022-11-23T18:30:41+01:00","author":{"@type":"Person","name":"Miro Bezjak"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://mbezjak.github.io/posts/configuration/"},"publisher":{"@type":"Organization","name":"Well Organized Bits","logo":{"@type":"ImageObject","url":"https://mbezjak.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://mbezjak.github.io/ accesskey=h title="Well Organized Bits (Alt + H)">Well Organized Bits</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://mbezjak.github.io/archives/ title=Archive><span>Archive</span></a></li><li><a href=mailto:well.organized.bits@proton.me title=Contact><span>Contact</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://mbezjak.github.io/>Home</a>&nbsp;»&nbsp;<a href=https://mbezjak.github.io/posts/>Posts</a></div><h1 class="post-title entry-hint-parent">Configuration</h1><div class=post-meta><span title='2022-11-23 18:30:41 +0100 +0100'>November 23, 2022</span>&nbsp;·&nbsp;Miro Bezjak&nbsp;|&nbsp;<a href=https://github.com/mbezjak/mbezjak.github.io/blob/main/content/posts/configuration.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=post-content><p>Which library do you use for project configuration? There are so many to choose
from. Take a look at <a href=https://www.clojure-toolbox.com>The Clojure Toolbox</a> under
&ldquo;Configuration&rdquo;. Choosing the right one mostly comes down to that you want out
of the configuration library.</p><p>Here are my requirements:</p><ul><li>It should not maintain it&rsquo;s own state. So
<a href=https://github.com/weavejester/environ>environ</a> is out.</li><li>It should allow the project to control configuration sources (e.g. from
environmental variables, java properties, command line arguments, file (edn?)
on the classpath, external file, etc.) and their order.
<a href=https://github.com/tolitius/cprop>cprop</a> seems simple enough, but there is
one other requirement.</li><li>It should help document the configuration that the project uses. After all,
someone needs to know how to configure the service properly. Is it
<code>DATABASE_URL</code>? <code>DB_URL</code>? <code>DB</code>? What else is there to configure?
<a href=https://github.com/juxt/aero>aero</a> seems to be on the right track.</li></ul><p>However, if those are the only requirements then implementing your own
configuration &ldquo;library&rdquo; becomes really simple in Clojure.</p><p>Here is what worked quite well for me.</p><p><code>config_init.clj</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=display:flex><span>(<span style=color:#66d9ef>ns </span>config-init
</span></span><span style=display:flex><span>  (<span style=color:#e6db74>:refer-clojure</span> <span style=color:#e6db74>:exclude</span> [load])
</span></span><span style=display:flex><span>  (<span style=color:#e6db74>:require</span>
</span></span><span style=display:flex><span>   [clojure.edn <span style=color:#e6db74>:as</span> edn]
</span></span><span style=display:flex><span>   [clojure.java.io <span style=color:#e6db74>:as</span> io]
</span></span><span style=display:flex><span>   [my.company.map <span style=color:#e6db74>:as</span> map]
</span></span><span style=display:flex><span>   [my.company.text <span style=color:#e6db74>:as</span> text]))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span><span style=color:#75715e>;; Default values are production quality safe! It&#39;s up to development-like</span>
</span></span><span style=display:flex><span><span style=color:#75715e>;; environments to relax the constrains a bit.</span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>def </span><span style=color:#f92672>^</span><span style=color:#e6db74>:private</span> known-configs
</span></span><span style=display:flex><span>  [<span style=color:#75715e>;; required</span>
</span></span><span style=display:flex><span>   {<span style=color:#e6db74>:key</span> <span style=color:#e6db74>:db-url</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:env</span> <span style=color:#e6db74>&#34;DB_URL&#34;</span>}
</span></span><span style=display:flex><span>   {<span style=color:#e6db74>:key</span> <span style=color:#e6db74>:db-password</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:env</span> <span style=color:#e6db74>&#34;DB_PASSWORD&#34;</span>}
</span></span><span style=display:flex><span>   {<span style=color:#e6db74>:key</span> <span style=color:#e6db74>:keycloak-issuer-url</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:env</span> <span style=color:#e6db74>&#34;KEYCLOAK_ISSUER_URL&#34;</span>}
</span></span><span style=display:flex><span>   {<span style=color:#e6db74>:key</span> <span style=color:#e6db74>:keycloak-client-id</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:env</span> <span style=color:#e6db74>&#34;KEYCLOAK_CLIENT_ID&#34;</span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   <span style=color:#75715e>;; optional</span>
</span></span><span style=display:flex><span>   {<span style=color:#e6db74>:key</span> <span style=color:#e6db74>:elasticsearch-url</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:env</span> <span style=color:#e6db74>&#34;ELASTICSEARCH_URL&#34;</span>}
</span></span><span style=display:flex><span>   {<span style=color:#e6db74>:key</span> <span style=color:#e6db74>:kms-key-id</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:env</span> <span style=color:#e6db74>&#34;KMS_KEY_ID&#34;</span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   <span style=color:#75715e>;; usually different in development-like environments</span>
</span></span><span style=display:flex><span>   {<span style=color:#e6db74>:key</span> <span style=color:#e6db74>:enable-debug-logging</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:default</span> false
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:env</span> <span style=color:#e6db74>&#34;ENABLE_DEBUG_LOGGING&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:env-transform</span> text/try-as-boolean}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   <span style=color:#75715e>;; rarely needs to be redefined</span>
</span></span><span style=display:flex><span>   {<span style=color:#e6db74>:key</span> <span style=color:#e6db74>:api-port</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:default</span> <span style=color:#ae81ff>8800</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:env</span> <span style=color:#e6db74>&#34;API_PORT&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:env-transform</span> text/try-as-int}
</span></span><span style=display:flex><span>   {<span style=color:#e6db74>:key</span> <span style=color:#e6db74>:flyway-version</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:default</span> <span style=color:#e6db74>&#34;latest&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:env</span> <span style=color:#e6db74>&#34;FLYWAY_VERSION&#34;</span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   <span style=color:#75715e>;; for deployed service: added via Dockerfile</span>
</span></span><span style=display:flex><span>   {<span style=color:#e6db74>:key</span> <span style=color:#e6db74>:git-tag</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:env</span> <span style=color:#e6db74>&#34;GIT_TAG&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:env-transform</span> not-empty}
</span></span><span style=display:flex><span>   {<span style=color:#e6db74>:key</span> <span style=color:#e6db74>:git-commit-sha</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:env</span> <span style=color:#e6db74>&#34;GIT_COMMIT_SHA&#34;</span>}
</span></span><span style=display:flex><span>   {<span style=color:#e6db74>:key</span> <span style=color:#e6db74>:build-time</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:env</span> <span style=color:#e6db74>&#34;BUILD_TIME&#34;</span>}
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>   <span style=color:#75715e>;; local development</span>
</span></span><span style=display:flex><span>   {<span style=color:#e6db74>:key</span> <span style=color:#e6db74>:developer-focused-logs</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:default</span> false
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:env</span> <span style=color:#e6db74>&#34;DEVELOPER_FOCUSED_LOGS&#34;</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:env-transform</span> text/try-as-boolean}])
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>defn- </span>from-defaults []
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>-&gt;&gt;</span> known-configs
</span></span><span style=display:flex><span>       (filter <span style=color:#f92672>#</span>(contains? % <span style=color:#e6db74>:default</span>))
</span></span><span style=display:flex><span>       (map (<span style=color:#a6e22e>juxt</span> <span style=color:#e6db74>:key</span> <span style=color:#e6db74>:default</span>))
</span></span><span style=display:flex><span>       (into {})))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>defn- </span>from-local-edn []
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>let </span>[f (<span style=color:#a6e22e>io/file</span> <span style=color:#e6db74>&#34;local/resources/config.edn&#34;</span>)]
</span></span><span style=display:flex><span>    (when (<span style=color:#a6e22e>.exists</span> f)
</span></span><span style=display:flex><span>      (<span style=color:#a6e22e>edn/read-string</span> (slurp f)))))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>defn- </span>from-env []
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>let </span>[m (<span style=color:#a6e22e>-&gt;&gt;</span> known-configs
</span></span><span style=display:flex><span>               (filter <span style=color:#e6db74>:env</span>)
</span></span><span style=display:flex><span>               (map (<span style=color:#66d9ef>fn </span>[{<span style=color:#e6db74>:keys</span> [key env env-transform]}]
</span></span><span style=display:flex><span>                      (<span style=color:#66d9ef>let </span>[transform (or env-transform identity)]
</span></span><span style=display:flex><span>                        [key (<span style=color:#a6e22e>transform</span> (<span style=color:#a6e22e>System/getenv</span> env))])))
</span></span><span style=display:flex><span>               (into {}))]
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>map/remove-val</span> m nil?)))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>defn </span>load []
</span></span><span style=display:flex><span>  (merge (<span style=color:#a6e22e>from-defaults</span>)
</span></span><span style=display:flex><span>         (<span style=color:#a6e22e>from-local-edn</span>)
</span></span><span style=display:flex><span>         (<span style=color:#a6e22e>from-env</span>)))
</span></span></code></pre></div><p>That is all there is to it. Refer to <a href=../clojure-core-extensions>clojure.core
extensions</a> for some of the functions used here.</p><p>Configuration for local development can be something like the following.</p><p><code>local/resources/config.edn</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=display:flex><span>{<span style=color:#e6db74>:db-password</span> <span style=color:#e6db74>&#34;postgres&#34;</span>
</span></span><span style=display:flex><span> <span style=color:#e6db74>:db-url</span> <span style=color:#e6db74>&#34;jdbc:postgresql://localhost:5432/db?user=postgres&#34;</span>
</span></span><span style=display:flex><span> <span style=color:#e6db74>:keycloak-issuer-url</span> <span style=color:#e6db74>&#34;https://auth.development.company.com/realms/customer&#34;</span>
</span></span><span style=display:flex><span> <span style=color:#e6db74>:keycloak-client-id</span> <span style=color:#e6db74>&#34;mobile-app&#34;</span>
</span></span><span style=display:flex><span> <span style=color:#e6db74>:enable-debug-logging</span> true
</span></span><span style=display:flex><span> <span style=color:#e6db74>:developer-focused-logs</span> true
</span></span><span style=display:flex><span> <span style=color:#e6db74>:git-commit-sha</span> <span style=color:#e6db74>&#34;local-development&#34;</span>
</span></span><span style=display:flex><span> <span style=color:#e6db74>:build-time</span> <span style=color:#e6db74>&#34;1970-01-01T00:00:00+00:00&#34;</span>}
</span></span></code></pre></div><h2 id=extensions>Extensions<a hidden class=anchor aria-hidden=true href=#extensions>#</a></h2><p>The nice thing when you have your own implementation is that adding stuff that
matters to your project becomes really simple.</p><p>For example, if you have a <code>/health</code> endpoint that returns service configuration
then you probably don&rsquo;t want it returning sensitive values. That seems simple to
solve. Just annotate the configuration as needed and redact the values before
returning them.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=display:flex><span>(<span style=color:#66d9ef>def </span><span style=color:#f92672>^</span><span style=color:#e6db74>:private</span> known-configs
</span></span><span style=display:flex><span>   ,,,
</span></span><span style=display:flex><span>   {<span style=color:#e6db74>:key</span> <span style=color:#e6db74>:db-password</span>
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:sensitive?</span> true
</span></span><span style=display:flex><span>    <span style=color:#e6db74>:env</span> <span style=color:#e6db74>&#34;DB_PASSWORD&#34;</span>}
</span></span><span style=display:flex><span>   ,,,)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>defn </span>redact-sensitive-values [config]
</span></span><span style=display:flex><span>  (reduce <span style=color:#f92672>#</span>(assoc %1 %2 <span style=color:#e6db74>&#34;&lt;redacted&gt;&#34;</span>)
</span></span><span style=display:flex><span>          config
</span></span><span style=display:flex><span>          (<span style=color:#a6e22e>-&gt;&gt;</span> known-configs (filter <span style=color:#e6db74>:sensitive?</span>) (map <span style=color:#e6db74>:key</span>))))
</span></span></code></pre></div><p>Other ideas:</p><ul><li>add <code>:documentation</code> to those variables where the usage is not clear enough</li><li>add <code>:used-by #{:admin :mobile}</code> to signal which services are using this
variable</li></ul></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>&copy; 2024 <a href=https://mbezjak.github.io/>Well Organized Bits</a></span> ·
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg>
</a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>