<!doctype html><html lang=en dir=auto><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=robots content="index, follow"><title>Clojure Debugging Helpers | Well Organized Bits</title><meta name=keywords content><meta name=description content="I highly recommend Repl Driven Development by Stuart Halloway if you haven&rsquo;t watched it already. It&rsquo;s a real eye opener when it comes to the topic of REPL and how to use it to your advantage. Two sentence summary of that presentation could easily be:
Don&rsquo;t type into REPL! Send things to the REPL!
As soon as you begin to understand that message, a whole new world opens up where some things become so incredibly simple."><meta name=author content="Miro Bezjak"><link rel=canonical href=https://mbezjak.github.io/posts/clojure-debugging-helpers/><meta name=google-site-verification content="62Vyu3hWVePJQe8DUK8iM3Xn2VdjXAAagXEIxsL5To0"><link crossorigin=anonymous href=/assets/css/stylesheet.bc1149f4a72aa4858d3a9f71462f75e5884ffe8073ea9d6d5761d5663d651e20.css integrity="sha256-vBFJ9KcqpIWNOp9xRi915YhP/oBz6p1tV2HVZj1lHiA=" rel="preload stylesheet" as=style><script defer crossorigin=anonymous src=/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG+9vmJ0cTS+ovo0FeA=" onload=hljs.initHighlightingOnLoad()></script>
<link rel=icon href=https://mbezjak.github.io/favicon.ico><link rel=icon type=image/png sizes=16x16 href=https://mbezjak.github.io/favicon-16x16.png><link rel=icon type=image/png sizes=32x32 href=https://mbezjak.github.io/favicon-32x32.png><link rel=apple-touch-icon href=https://mbezjak.github.io/apple-touch-icon.png><link rel=mask-icon href=https://mbezjak.github.io/safari-pinned-tab.svg><meta name=theme-color content="#2e2e33"><meta name=msapplication-TileColor content="#2e2e33"><noscript><style>#theme-toggle,.top-link{display:none}</style><style>@media(prefers-color-scheme:dark){:root{--theme:rgb(29, 30, 32);--entry:rgb(46, 46, 51);--primary:rgb(218, 218, 219);--secondary:rgb(155, 156, 157);--tertiary:rgb(65, 66, 68);--content:rgb(196, 196, 197);--hljs-bg:rgb(46, 46, 51);--code-bg:rgb(55, 56, 62);--border:rgb(51, 51, 51)}.list{background:var(--theme)}.list:not(.dark)::-webkit-scrollbar-track{background:0 0}.list:not(.dark)::-webkit-scrollbar-thumb{border-color:var(--theme)}}</style></noscript><meta property="og:title" content="Clojure Debugging Helpers"><meta property="og:description" content="I highly recommend Repl Driven Development by Stuart Halloway if you haven&rsquo;t watched it already. It&rsquo;s a real eye opener when it comes to the topic of REPL and how to use it to your advantage. Two sentence summary of that presentation could easily be:
Don&rsquo;t type into REPL! Send things to the REPL!
As soon as you begin to understand that message, a whole new world opens up where some things become so incredibly simple."><meta property="og:type" content="article"><meta property="og:url" content="https://mbezjak.github.io/posts/clojure-debugging-helpers/"><meta property="article:section" content="posts"><meta property="article:published_time" content="2022-11-11T10:53:47+01:00"><meta property="article:modified_time" content="2022-11-11T10:53:47+01:00"><meta name=twitter:card content="summary"><meta name=twitter:title content="Clojure Debugging Helpers"><meta name=twitter:description content="I highly recommend Repl Driven Development by Stuart Halloway if you haven&rsquo;t watched it already. It&rsquo;s a real eye opener when it comes to the topic of REPL and how to use it to your advantage. Two sentence summary of that presentation could easily be:
Don&rsquo;t type into REPL! Send things to the REPL!
As soon as you begin to understand that message, a whole new world opens up where some things become so incredibly simple."><script type=application/ld+json>{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":2,"name":"Posts","item":"https://mbezjak.github.io/posts/"},{"@type":"ListItem","position":3,"name":"Clojure Debugging Helpers","item":"https://mbezjak.github.io/posts/clojure-debugging-helpers/"}]}</script><script type=application/ld+json>{"@context":"https://schema.org","@type":"BlogPosting","headline":"Clojure Debugging Helpers","name":"Clojure Debugging Helpers","description":"I highly recommend Repl Driven Development by Stuart Halloway if you haven\u0026rsquo;t watched it already. It\u0026rsquo;s a real eye opener when it comes to the topic of REPL and how to use it to your advantage. Two sentence summary of that presentation could easily be:\nDon\u0026rsquo;t type into REPL! Send things to the REPL!\nAs soon as you begin to understand that message, a whole new world opens up where some things become so incredibly simple.","keywords":[],"articleBody":"I highly recommend Repl Driven Development by Stuart Halloway if you haven’t watched it already. It’s a real eye opener when it comes to the topic of REPL and how to use it to your advantage. Two sentence summary of that presentation could easily be:\nDon’t type into REPL! Send things to the REPL!\nAs soon as you begin to understand that message, a whole new world opens up where some things become so incredibly simple. For example, how to debug a misbehaving ring handler?\n(defn handler [request] ,,,) Just make a binding that can be manipulated. Then reevaluate the handler (send updated defn to the REPL).\n(defn handler [request] (def request request) ,,,) When the new handler executes, request becomes available for prodding as a top-level var. What can you do with it? Well, what do you need to investigate the problem? Send more things to the REPL. Here are a couple of examples:\n(-\u003e request :params :user-id) (-\u003e request :body :what :does :not :look :right?) (get-in request [:headers \"user-agent\"]) (reitit-ring/get-match request) (-\u003e request (reitit-ring/get-match) :data (get (:request-method request))) (db/get-user (-\u003e request :params :user-id)) This technique is so general that it can be used almost everywhere.\nwith defn-, let, letfn, if-let, when-let, binding, with-redefs, … in src or test It does get a bit tedious sometimes. E.g. when needing to litter the code (temporarily) with a bunch of def expressions.\n(defn handler [{:keys [params body] :as request}] (def request request) (def params params) (def body body) (let [db (:db/admin request) user-id (:user-id params) user (db/get-user db user-id)] (def db db) (def user-id user-id) (def user user) (do-something user body))) Wouldn’t it be nice if I could specify that I want to add def expressions for every binding without having to type (or expand) too much? How about something like the following?\n(defn/d handler [{:keys [params body] :as request}] (let/d [db (:db/admin request) user-id (:user-id params) user (db/get-user db user-id)] (do-something user body))) Notice the variants defn/d and let/d instead of normal clojure.core/defn and clojure.core/let. What would it take for this to work? Here is what I ended up with and am quite happy using it.\nThe two helper namespaces are in the repl directory. 1\nrepl/defn.clj\n(ns defn) (defn symbols [args] (mapcat (fn [a] (cond (map? a) (:keys a) (vector? a) (symbols a) :else [a])) args)) (defmacro d [fn-name \u0026 fdecl] (let [[args body] (if (string? (first fdecl)) [(second fdecl) (not-empty (drop 2 fdecl))] [(first fdecl) (not-empty (rest fdecl))]) defs (map (fn [s] `(def ~s ~s)) (symbols args))] `(defn ~fn-name ~args ~@defs ~@body))) repl/let.clj\n(ns let) (defmacro d [bindings \u0026 body] (let [bindings-with-defs (-\u003e\u003e bindings (destructure) (partition 2) (mapcat (fn [[s code]] [s code (gensym \"not-used\") `(def ~s ~s)])))] `(let [~@bindings-with-defs] ~@body))) For the helpers to be usable elsewhere in the project I made sure the following was evaluated every time I started the project in the REPL:\n(load-file \"repl/let.clj\") (load-file \"repl/defn.clj\") That’s it! Now I can use those helpers so I don’t have to write a bunch of def expressions anymore.\n(defn/d handler [{:keys [params body] :as request}] (let/d [db (:db/admin request) user-id (:user-id params) user (db/get-user db user-id)] (do-something user body))) Adapting the helpers to your own situation If you don’t want to use load-file, you can put the helpers on the classpath and require them.\nIf you don’t have monorepo then you need to decide where it makes the most sense to put the helpers, but load-file might still be your best way of including the code in the project.\nIf you don’t like that the helpers are in a separate namespace then you can add them to clojure.core and use them like any other clojure.core fn.\n(do (in-ns 'clojure.core) (defmacro defnd ,,,) (defmacro letd ,,,)) The helpers above are not perfect, but are quite adequate. For example, I didn’t have a strong need to create macros to cover defn-, letfn, if-let, when-let, binding, with-redefs, or defn with additional metadata. Those usages are rare enough that I can add def expressions manually. Feel free to develop your own helpers that match the situation you’re in.\nFor complete files see: https://gist.github.com/mbezjak/0f11c0b550a0751c66903947328f947c ↩︎\n","wordCount":"684","inLanguage":"en","datePublished":"2022-11-11T10:53:47+01:00","dateModified":"2022-11-11T10:53:47+01:00","author":{"@type":"Person","name":"Miro Bezjak"},"mainEntityOfPage":{"@type":"WebPage","@id":"https://mbezjak.github.io/posts/clojure-debugging-helpers/"},"publisher":{"@type":"Organization","name":"Well Organized Bits","logo":{"@type":"ImageObject","url":"https://mbezjak.github.io/favicon.ico"}}}</script></head><body id=top><script>localStorage.getItem("pref-theme")==="dark"?document.body.classList.add("dark"):localStorage.getItem("pref-theme")==="light"?document.body.classList.remove("dark"):window.matchMedia("(prefers-color-scheme: dark)").matches&&document.body.classList.add("dark")</script><header class=header><nav class=nav><div class=logo><a href=https://mbezjak.github.io accesskey=h title="Well Organized Bits (Alt + H)">Well Organized Bits</a><div class=logo-switches><button id=theme-toggle accesskey=t title="(Alt + T)"><svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1111.21 3 7 7 0 0021 12.79z"/></svg><svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24" fill="none" stroke="currentcolor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg></button></div></div><ul id=menu><li><a href=https://mbezjak.github.io/archives/ title=Archive><span>Archive</span></a></li><li><a href=mailto:well.organized.bits@proton.me title=Contact><span>Contact</span></a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><div class=breadcrumbs><a href=https://mbezjak.github.io>Home</a>&nbsp;»&nbsp;<a href=https://mbezjak.github.io/posts/>Posts</a></div><h1 class=post-title>Clojure Debugging Helpers</h1><div class=post-meta><span title='2022-11-11 10:53:47 +0100 +0100'>November 11, 2022</span>&nbsp;·&nbsp;Miro Bezjak&nbsp;|&nbsp;<a href=https://github.com/mbezjak/mbezjak.github.io/blob/main/content/posts/clojure-debugging-helpers.md rel="noopener noreferrer" target=_blank>Suggest Changes</a></div></header><div class=post-content><p>I highly recommend <a href=https://vimeo.com/223309989>Repl Driven Development by Stuart
Halloway</a> if you haven&rsquo;t watched it already. It&rsquo;s a
real eye opener when it comes to the topic of REPL and how to use it to your
advantage. Two sentence summary of that presentation could easily be:</p><blockquote><p>Don&rsquo;t type into REPL! Send things to the REPL!</p></blockquote><p>As soon as you begin to understand that message, a whole new world opens up
where some things become so incredibly simple. For example, how to debug a
misbehaving <a href=https://github.com/ring-clojure/ring/wiki/Concepts>ring handler</a>?</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=display:flex><span>(<span style=color:#66d9ef>defn </span>handler [request]
</span></span><span style=display:flex><span>  ,,,)
</span></span></code></pre></div><p>Just make a binding that can be manipulated. Then reevaluate the handler (send
updated <code>defn</code> to the REPL).</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=display:flex><span>(<span style=color:#66d9ef>defn </span>handler [request]
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>def </span>request request)
</span></span><span style=display:flex><span>  ,,,)
</span></span></code></pre></div><p>When the new handler executes, <code>request</code> becomes available for prodding as a
top-level <em>var</em>. What can you do with it? Well, what do you need to investigate
the problem? Send more things to the REPL. Here are a couple of examples:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=display:flex><span>(-&gt; request <span style=color:#e6db74>:params</span> <span style=color:#e6db74>:user-id</span>)
</span></span><span style=display:flex><span>(-&gt; request <span style=color:#e6db74>:body</span> <span style=color:#e6db74>:what</span> <span style=color:#e6db74>:does</span> <span style=color:#e6db74>:not</span> <span style=color:#e6db74>:look</span> <span style=color:#e6db74>:right?</span>)
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>get-in</span> request [<span style=color:#e6db74>:headers</span> <span style=color:#e6db74>&#34;user-agent&#34;</span>])
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>reitit-ring/get-match</span> request)
</span></span><span style=display:flex><span>(-&gt; request (<span style=color:#a6e22e>reitit-ring/get-match</span>) <span style=color:#e6db74>:data</span> (get (<span style=color:#e6db74>:request-method</span> request)))
</span></span><span style=display:flex><span>(<span style=color:#a6e22e>db/get-user</span> (-&gt; request <span style=color:#e6db74>:params</span> <span style=color:#e6db74>:user-id</span>))
</span></span></code></pre></div><p>This technique is so general that it can be used almost everywhere.</p><ul><li>with <code>defn-</code>, <code>let</code>, <code>letfn</code>, <code>if-let</code>, <code>when-let</code>, <code>binding</code>, <code>with-redefs</code>,
&mldr;</li><li>in <code>src</code> or <code>test</code></li></ul><p>It does get a bit tedious sometimes. E.g. when needing to litter the code
(temporarily) with a bunch of <code>def</code> expressions.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=display:flex><span>(<span style=color:#66d9ef>defn </span>handler [{<span style=color:#e6db74>:keys</span> [params body] <span style=color:#e6db74>:as</span> request}]
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>def </span>request request)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>def </span>params params)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>def </span>body body)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>let </span>[db (<span style=color:#e6db74>:db/admin</span> request)
</span></span><span style=display:flex><span>        user-id (<span style=color:#e6db74>:user-id</span> params)
</span></span><span style=display:flex><span>        user (<span style=color:#a6e22e>db/get-user</span> db user-id)]
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>def </span>db db)
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>def </span>user-id user-id)
</span></span><span style=display:flex><span>    (<span style=color:#66d9ef>def </span>user user)
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>do-something</span> user body)))
</span></span></code></pre></div><p>Wouldn&rsquo;t it be nice if I could specify that I want to add <code>def</code> expressions for
every binding without having to type (or
<a href=https://github.com/mbezjak/dotfiles/blob/main/emacs.d/snippets/clojure-mode/dd>expand</a>)
too much? How about something like the following?</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=display:flex><span>(<span style=color:#a6e22e>defn/d</span> handler [{<span style=color:#e6db74>:keys</span> [params body] <span style=color:#e6db74>:as</span> request}]
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>let/d</span> [db (<span style=color:#e6db74>:db/admin</span> request)
</span></span><span style=display:flex><span>          user-id (<span style=color:#e6db74>:user-id</span> params)
</span></span><span style=display:flex><span>          user (<span style=color:#a6e22e>db/get-user</span> db user-id)]
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>do-something</span> user body)))
</span></span></code></pre></div><p>Notice the variants <code>defn/d</code> and <code>let/d</code> instead of normal <code>clojure.core/defn</code>
and <code>clojure.core/let</code>. What would it take for this to work? Here is what I
ended up with and am quite happy using it.</p><p>The two helper namespaces are in the <code>repl</code> directory. <sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup></p><p><code>repl/defn.clj</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=display:flex><span>(<span style=color:#66d9ef>ns </span>defn)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>defn </span>symbols [args]
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>mapcat</span>
</span></span><span style=display:flex><span>   (<span style=color:#66d9ef>fn </span>[a]
</span></span><span style=display:flex><span>     (<span style=color:#a6e22e>cond</span>
</span></span><span style=display:flex><span>       (map? a) (<span style=color:#e6db74>:keys</span> a)
</span></span><span style=display:flex><span>       (vector? a) (<span style=color:#a6e22e>symbols</span> a)
</span></span><span style=display:flex><span>       <span style=color:#e6db74>:else</span> [a]))
</span></span><span style=display:flex><span>   args))
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>defmacro </span>d [fn-name <span style=color:#f92672>&amp;</span> fdecl]
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>let </span>[[args body] (<span style=color:#66d9ef>if </span>(string? (first fdecl))
</span></span><span style=display:flex><span>                      [(second fdecl) (<span style=color:#a6e22e>not-empty</span> (drop <span style=color:#ae81ff>2</span> fdecl))]
</span></span><span style=display:flex><span>                      [(first fdecl) (<span style=color:#a6e22e>not-empty</span> (rest fdecl))])
</span></span><span style=display:flex><span>        defs (map (<span style=color:#66d9ef>fn </span>[s] <span style=color:#f92672>`</span>(<span style=color:#66d9ef>def </span><span style=color:#f92672>~</span>s <span style=color:#f92672>~</span>s)) (<span style=color:#a6e22e>symbols</span> args))]
</span></span><span style=display:flex><span>    <span style=color:#f92672>`</span>(<span style=color:#66d9ef>defn </span><span style=color:#f92672>~</span>fn-name <span style=color:#f92672>~</span>args
</span></span><span style=display:flex><span>       <span style=color:#f92672>~@</span>defs
</span></span><span style=display:flex><span>       <span style=color:#f92672>~@</span>body)))
</span></span></code></pre></div><p><code>repl/let.clj</code></p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=display:flex><span>(<span style=color:#66d9ef>ns </span>let)
</span></span><span style=display:flex><span>
</span></span><span style=display:flex><span>(<span style=color:#66d9ef>defmacro </span>d [bindings <span style=color:#f92672>&amp;</span> body]
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>let </span>[bindings-with-defs (<span style=color:#a6e22e>-&gt;&gt;</span> bindings
</span></span><span style=display:flex><span>                                (<span style=color:#a6e22e>destructure</span>)
</span></span><span style=display:flex><span>                                (<span style=color:#a6e22e>partition</span> <span style=color:#ae81ff>2</span>)
</span></span><span style=display:flex><span>                                (mapcat (<span style=color:#66d9ef>fn </span>[[s code]]
</span></span><span style=display:flex><span>                                          [s code
</span></span><span style=display:flex><span>                                           (gensym <span style=color:#e6db74>&#34;not-used&#34;</span>) <span style=color:#f92672>`</span>(<span style=color:#66d9ef>def </span><span style=color:#f92672>~</span>s <span style=color:#f92672>~</span>s)])))]
</span></span><span style=display:flex><span>    <span style=color:#f92672>`</span>(<span style=color:#66d9ef>let </span>[<span style=color:#f92672>~@</span>bindings-with-defs]
</span></span><span style=display:flex><span>       <span style=color:#f92672>~@</span>body)))
</span></span></code></pre></div><p>For the helpers to be usable elsewhere in the project I made sure the following
was <a href=https://github.com/mbezjak/dotfiles/blob/99acf8c8354a242a4035dd064122b1f1a531e787/emacs.d/lisp/my-functions.el#L254>evaluated every time I started the
project</a>
in the REPL:</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=display:flex><span>(load-file <span style=color:#e6db74>&#34;repl/let.clj&#34;</span>)
</span></span><span style=display:flex><span>(load-file <span style=color:#e6db74>&#34;repl/defn.clj&#34;</span>)
</span></span></code></pre></div><p>That&rsquo;s it! Now I can use those helpers so I don&rsquo;t have to write a bunch of
<code>def</code> expressions anymore.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=display:flex><span>(<span style=color:#a6e22e>defn/d</span> handler [{<span style=color:#e6db74>:keys</span> [params body] <span style=color:#e6db74>:as</span> request}]
</span></span><span style=display:flex><span>  (<span style=color:#a6e22e>let/d</span> [db (<span style=color:#e6db74>:db/admin</span> request)
</span></span><span style=display:flex><span>          user-id (<span style=color:#e6db74>:user-id</span> params)
</span></span><span style=display:flex><span>          user (<span style=color:#a6e22e>db/get-user</span> db user-id)]
</span></span><span style=display:flex><span>    (<span style=color:#a6e22e>do-something</span> user body)))
</span></span></code></pre></div><h2 id=adapting-the-helpers-to-your-own-situation>Adapting the helpers to your own situation<a hidden class=anchor aria-hidden=true href=#adapting-the-helpers-to-your-own-situation>#</a></h2><ul><li><p>If you don&rsquo;t want to use <code>load-file</code>, you can put the helpers on the classpath
and <code>require</code> them.</p></li><li><p>If you don&rsquo;t have monorepo then you need to decide where it makes the most
sense to put the helpers, but <code>load-file</code> might still be your best way of
including the code in the project.</p></li><li><p>If you don&rsquo;t like that the helpers are in a separate namespace then you can
add them to <code>clojure.core</code> and use them like any other <code>clojure.core</code> fn.</p><div class=highlight><pre tabindex=0 style=color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4><code class=language-clojure data-lang=clojure><span style=display:flex><span>(<span style=color:#a6e22e>do</span>
</span></span><span style=display:flex><span>  (in-ns <span style=color:#e6db74>&#39;clojure.core</span>)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>defmacro </span>defnd ,,,)
</span></span><span style=display:flex><span>  (<span style=color:#66d9ef>defmacro </span>letd ,,,))
</span></span></code></pre></div></li><li><p>The helpers above are not perfect, but are quite adequate. For example, I
didn&rsquo;t have a strong need to create macros to cover <code>defn-</code>, <code>letfn</code>,
<code>if-let</code>, <code>when-let</code>, <code>binding</code>, <code>with-redefs</code>, or <code>defn</code> with additional
metadata. Those usages are rare enough that I can add <code>def</code> expressions
manually. Feel free to develop your own helpers that match the situation
you&rsquo;re in.</p></li></ul><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p>For complete files see:
<a href=https://gist.github.com/mbezjak/0f11c0b550a0751c66903947328f947c>https://gist.github.com/mbezjak/0f11c0b550a0751c66903947328f947c</a>&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div></div><footer class=post-footer><ul class=post-tags></ul></footer></article></main><footer class=footer><span>&copy; 2022 <a href=https://mbezjak.github.io>Well Organized Bits</a></span>
<span>Powered by
<a href=https://gohugo.io/ rel="noopener noreferrer" target=_blank>Hugo</a> &
        <a href=https://github.com/adityatelange/hugo-PaperMod/ rel=noopener target=_blank>PaperMod</a></span></footer><a href=#top aria-label="go to top" title="Go to Top (Alt + G)" class=top-link id=top-link accesskey=g><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentcolor"><path d="M12 6H0l6-6z"/></svg></a><script>let menu=document.getElementById("menu");menu&&(menu.scrollLeft=localStorage.getItem("menu-scroll-position"),menu.onscroll=function(){localStorage.setItem("menu-scroll-position",menu.scrollLeft)}),document.querySelectorAll('a[href^="#"]').forEach(e=>{e.addEventListener("click",function(e){e.preventDefault();var t=this.getAttribute("href").substr(1);window.matchMedia("(prefers-reduced-motion: reduce)").matches?document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView():document.querySelector(`[id='${decodeURIComponent(t)}']`).scrollIntoView({behavior:"smooth"}),t==="top"?history.replaceState(null,null," "):history.pushState(null,null,`#${t}`)})})</script><script>var mybutton=document.getElementById("top-link");window.onscroll=function(){document.body.scrollTop>800||document.documentElement.scrollTop>800?(mybutton.style.visibility="visible",mybutton.style.opacity="1"):(mybutton.style.visibility="hidden",mybutton.style.opacity="0")}</script><script>document.getElementById("theme-toggle").addEventListener("click",()=>{document.body.className.includes("dark")?(document.body.classList.remove("dark"),localStorage.setItem("pref-theme","light")):(document.body.classList.add("dark"),localStorage.setItem("pref-theme","dark"))})</script><script>document.querySelectorAll("pre > code").forEach(e=>{const n=e.parentNode.parentNode,t=document.createElement("button");t.classList.add("copy-code"),t.innerHTML="copy";function s(){t.innerHTML="copied!",setTimeout(()=>{t.innerHTML="copy"},2e3)}t.addEventListener("click",t=>{if("clipboard"in navigator){navigator.clipboard.writeText(e.textContent),s();return}const n=document.createRange();n.selectNodeContents(e);const o=window.getSelection();o.removeAllRanges(),o.addRange(n);try{document.execCommand("copy"),s()}catch{}o.removeRange(n)}),n.classList.contains("highlight")?n.appendChild(t):n.parentNode.firstChild==n||(e.parentNode.parentNode.parentNode.parentNode.parentNode.nodeName=="TABLE"?e.parentNode.parentNode.parentNode.parentNode.parentNode.appendChild(t):e.parentNode.appendChild(t))})</script></body></html>